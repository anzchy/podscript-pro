# 接口定义

## HTTP API（FastAPI）

### 任务管理
- `POST /tasks`
  - 请求：`{ source_url: string, platform?: string, options?: object }`
  - 响应：`{ id: string, status: "queued", progress: 0.0 }`
- `POST /tasks/{id}/transcribe`
  - 参数：`provider=whisper|tingwu`
  - 响应：`{ message: string }`
- `GET /tasks/{id}`
  - 响应：`{ id, status, progress, error?, results? }`
- `GET /tasks/{id}/results`
  - 响应：`{ srt_url: string, markdown_url: string, meta: object }`

### 历史记录 API
- `GET /history`
  - 参数：`page=1, limit=20, status=completed|deleted`
  - 响应：`{ total: number, page: number, limit: number, records: HistoryRecord[] }`
- `GET /history/{task_id}`
  - 响应：`HistoryRecord`
- `PATCH /history/{task_id}`
  - 请求：`{ viewed?: boolean, tags?: string[] }`
  - 响应：`{ success: true }`
- `DELETE /history/{task_id}`
  - 响应：`{ success: true }`（软删除）

## 数据模型（Pydantic）

### 任务模型
- `TaskCreateRequest`、`TaskSummary`、`TaskDetail`、`TaskResults`、`TaskStatus`

### 历史记录模型
- `HistoryRecord`：单条历史记录
  - `task_id`: string - 任务ID
  - `title`: string - 标题
  - `source_url`: string - 原始URL
  - `source_type`: youtube|upload|url - 来源类型
  - `media_type`: video|audio - 媒体类型
  - `duration`: number - 时长（秒）
  - `file_size`: number - 文件大小（字节）
  - `tags`: string[] - 标签（自动提取+手动编辑）
  - `created_at`: datetime - 创建时间
  - `viewed`: boolean - 是否已查看
  - `status`: completed|deleted - 状态
- `HistoryListResponse`：历史记录列表响应
- `HistoryUpdateRequest`：更新请求

## 存储

### 历史记录存储
- 文件：`artifacts/history.json`
- 格式：JSON + filelock 并发控制
- 软删除：status=deleted，不从文件中移除
