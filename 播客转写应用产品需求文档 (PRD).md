# 播客转写应用产品需求文档 (PRD)

**版本**: 1.0
**日期**: 2025年11月15日
**作者**: Manus AI

## 1. 引言

### 1.1 项目背景

随着播客和在线音视频内容的爆炸式增长，用户对于高效获取和整理信息的需求日益强烈。许多用户希望能够将播客、访谈、讲座等内容快速转换为文字，以便于阅读、检索和引用。目前市场上的转写工具功能各异，但缺乏一个能够整合多平台音视频源、提供一站式下载和转写服务的便捷应用。

本项目旨在开发一个网页应用，用户只需提供来自 YouTube、小宇宙、Spotify、Apple Podcasts 等主流平台的播客链接，即可自动完成音视频的下载、转写，并生成带时间戳的字幕文件或格式化的 Markdown 文稿。

### 1.2 项目目标

- **核心目标**: 提供一个简单易用的网页应用，实现从播客链接到文字稿的自动化转换。
- **用户价值**: 帮助用户节省手动下载和整理音视频内容的时间，提高信息获取和处理效率。
- **商业价值**: 探索在内容创作、媒体监测、教育学习等领域的应用潜力，未来可拓展增值服务。

### 1.3 目标用户

- **内容创作者**: 需要将自己的播客内容整理成文字稿，用于发布文章、制作字幕或内容存档。
- **学生与研究人员**: 需要将讲座、访谈等学术内容转写为文字，方便学习和引用。
- **媒体从业者**: 需要快速整理发布会、采访等活动的录音录像，用于新闻稿撰写。
- **普通播客听众**: 希望将喜欢的播客节目保存为文字版，便于回顾和分享。

### 1.4 衡量指标

- **用户活跃度**: 日/月活跃用户数 (DAU/MAU)
- **核心功能使用率**: 每日转写任务数
- **用户满意度**: 用户反馈、NPS (净推荐值)
- **转写准确率**: 用户对转写结果的修正率
- **任务成功率**: 从链接提交到成功生成文稿的端到端成功率


## 2. 产品功能

### 2.1 功能总览

| 功能模块 | 核心功能 | 优先级 |
| :--- | :--- | :--- |
| **链接解析与提交** | 用户输入播客链接，系统自动识别平台并提交转写任务 | P0 |
| **音视频下载** | 从 YouTube、小宇宙、Spotify 等平台下载音视频文件 | P0 |
| **音视频转写** | 调用千问 API 将音视频文件转写为带时间戳的文本 | P0 |
| **结果输出** | 生成 SRT 字幕文件和 Markdown 格式的文稿 | P0 |
| **用户中心** | 用户注册、登录、查看历史转写任务 | P1 |
| **任务管理** | 查看任务状态、下载转写结果、删除历史任务 | P1 |
| **在线编辑** | 在网页上直接编辑和校对转写结果 | P2 |
| **多语言支持** | 支持多种语言的转写和界面显示 | P2 |

### 2.2 核心功能详述

#### 2.2.1 链接解析与提交

用户在首页的输入框中粘贴播客链接，点击“开始转写”按钮。系统将自动解析链接，识别其所属平台（如 YouTube、小宇宙等），并创建一个新的转写任务。提交后，页面会跳转到任务详情页，实时显示任务状态。

#### 2.2.2 音视频下载

后端服务接收到任务后，会根据平台类型调用相应的下载模块。对于 YouTube 等主流视频网站，将使用 `yt-dlp` 工具进行下载。对于小宇宙等特定播客平台，将使用定制化的爬虫脚本解析并下载音频。下载的音视频文件将临时存储在云存储（如阿里云 OSS）上，以便后续处理。

#### 2.2.3 音视频转写

音视频文件下载完成后，后端将调用阿里云通义千问的 `Qwen3-ASR` 模型进行转写。在调用 API 时，会传递文件的公网访问 URL。API 将返回包含完整文本和词级别时间戳的 JSON 数据。

#### 2.2.4 结果输出

转写完成后，系统会解析千问 API 返回的 JSON 数据，并根据用户的选择生成两种格式的文件：

- **SRT 文件**: 标准的字幕格式，包含序号、时间戳和文本，可用于视频播放器。
- **Markdown 文件**: 格式化的文稿，包含标题、段落，并可根据说话人进行区分，便于阅读和编辑。

用户可以在任务详情页直接下载这两种文件。

### 2.3 其他功能

#### 2.3.1 用户中心 (P1)

用户可以通过邮箱或手机号注册账号，并进行登录。登录后，用户可以查看自己提交的所有历史转写任务，方便管理和追溯。

#### 2.3.2 任务管理 (P1)

在用户中心，会有一个任务列表，显示每个任务的状态（排队中、下载中、转写中、已完成、失败）。用户可以点击查看任务详情，下载已完成任务的结果，或删除不再需要的历史任务。

#### 2.3.3 在线编辑 (P2)

对于已完成的转写任务，提供一个简单的在线编辑器。用户可以直接在网页上对转写结果进行校对和修改，修正识别错误或调整格式。修改后的内容可以重新导出为 SRT 或 Markdown 文件。

#### 2.3.4 多语言支持 (P2)

除了支持多种语言的音视频转写外，应用的界面本身也应支持多语言切换（如中文、英文），以服务更广泛的用户群体。


## 3. 技术方案

### 3.1 技术架构图（Python 全栈方案）

```mermaid
graph TD
    A[用户] -->|1. 交互| B(Reflex 前端);
    B -->|2. 调用事件处理器| D{Reflex 后端 (FastAPI)};
    D -->|3. 创建转写任务| J[数据库 (PostgreSQL)];
    D -->|4. 添加任务到队列| E[任务队列 (Redis)];
    F[Worker 服务 (Celery)] -->|5. 从队列获取任务| E;
    F -->|6. 下载音视频| G(yt-dlp);
    G -->|7. 上传文件| H[云存储 (OSS/S3)];
    F -->|8. 调用转写 API| I(千问 ASR API);
    I -->|9. 返回转写结果| F;
    F -->|10. 存储结果| J;
    F -->|11. 更新任务状态| J;
    B -->|12. 轮询状态| D;
    D -->|13. 返回任务状态和结果| B;
    B -->|14. 显示结果并提供下载| A;
```

### 3.2 技术栈选型（Python 全栈方案）

| 模块 | 技术 | 选型理由 |
| :--- | :--- | :--- |
| **全栈框架** | Reflex | **纯 Python 开发**，将前端和后端统一在一个项目中，极大提升开发效率。Reflex 将 Python 代码编译为高性能的 React 前端，并内置 FastAPI 作为后端，实现了真正的全栈 Python。 |
| **数据库** | PostgreSQL + Redis | PostgreSQL 功能强大，适合存储用户和任务数据；Redis 用于 Celery 任务队列和应用缓存。 |
| **文件存储** | 阿里云 OSS | 与千问 API 同属阿里云生态，内网传输速度快，成本效益高。 |
| **异步任务** | Celery + Redis | Celery 是成熟的 Python 分布式任务队列，用于处理耗时的下载和转写任务，避免阻塞主应用。 |
| **音频处理** | FFmpeg | 强大的音视频处理工具，通过 Python 的 `subprocess` 调用，用于格式转换和采样率调整。 |
| **部署** | Docker + 云服务器 | Docker 实现环境隔离和标准化部署；Reflex 应用可以方便地容器化，并部署在任何支持 Docker 的云服务器上。 |

### 3.3 核心流程实现（Python 全栈方案）

1.  **前端交互**: 用户在 Reflex 构建的前端界面中粘贴链接，并点击“转写”按钮。该按钮绑定一个事件处理器（Event Handler）。
2.  **状态更新与任务创建**: 事件处理器在 Reflex 的后端（FastAPI）执行。它首先更新应用状态（例如，设置 `is_loading = True`），然后将新的转写任务信息存入 PostgreSQL 数据库，并将任务 ID 推送到 Celery 任务队列（通过 Redis）。
3.  **异步任务处理**: 一个或多个独立的 Celery Worker 进程监听任务队列。获取到新任务后，Worker 开始执行下载和转写流程。
4.  **下载与预处理**: Worker 调用 `yt-dlp` Python 库下载音视频，并使用 `subprocess` 调用 FFmpeg 进行必要的格式和采样率转换。文件被流式上传到阿里云 OSS。
5.  **调用转写**: Worker 将文件的 OSS 公网 URL 发送给千问 ASR API，并等待转写完成。
6.  **保存结果**: 收到转写结果后，Worker 将其解析并生成 SRT 和 Markdown 文件，存入数据库。同时，更新任务状态为“已完成”。
7.  **结果展示**: 前端页面通过轮询或 WebSocket（Reflex 内置支持）自动感知状态变化。当任务完成后，界面上会显示“已完成”状态，并出现下载按钮，用户可以点击下载生成的文稿。


## 4. 非功能性需求

### 4.1 性能需求

- **响应时间**: 页面加载时间应在 3 秒以内。API 响应时间（不含任务处理）应在 200ms 以内。
- **处理速度**: 对于一个 1 小时长度的音频，从提交链接到转写完成的总时长应力争控制在 10 分钟以内（具体取决于下载速度和 API 处理速度）。
- **并发处理**: 系统初期应能支持至少 10 个并发转写任务。可通过增加 Worker 数量进行水平扩展。

### 4.2 可用性需求

- **UI/UX**: 界面设计应简洁直观，核心操作（粘贴链接、点击转写）一目了然。
- **任务状态**: 任务处理的每个阶段（排队、下载、转写、完成）都应有清晰的状态反馈，避免用户焦虑。
- **错误处理**: 对于无效链接、下载失败、转写失败等异常情况，应向用户提供明确的错误提示和可能的解决方案。
- **跨平台兼容**: 网站应在主流浏览器（Chrome, Firefox, Safari, Edge）的最新版本上表现一致。

### 4.3 可靠性需求

- **服务稳定性**: 核心服务（Web 应用、API、Worker）应保证 99.9% 的可用性。
- **任务重试**: 对于因网络波动或 API 临时故障导致的下载或转写失败，系统应支持自动重试机制（例如，重试 3 次）。
- **数据备份**: 数据库应配置定期备份策略，防止数据丢失。

### 4.4 安全性需求

- **用户认证**: 用户密码需要加盐存储，敏感操作需要身份验证。
- **API 安全**: 后端 API 应防止常见的 Web 攻击，如 SQL 注入、XSS、CSRF 等。
- **文件安全**: 用户上传或下载的文件链接应进行权限控制，避免未授权访问。
- **密钥管理**: 所有外部 API 密钥（如阿里云 AK/SK）都必须安全存储，不能硬编码在代码中。


## 5. 上线计划与迭代

### 5.1 V1.0 (MVP - 最小可行产品)

- **目标**: 快速上线核心功能，验证市场需求。
- **功能范围**:
  - 支持 YouTube、小宇宙链接提交。
  - 实现音视频下载和千问 API 转写。
  - 生成 SRT 和 Markdown 文件供用户下载。
  - 简单的任务状态展示页面（无需用户登录）。
- **时间计划**: 4-6 周开发周期。

### 5.2 V1.1

- **目标**: 优化用户体验，增加用户粘性。
- **功能范围**:
  - 增加用户注册和登录功能。
  - 实现任务历史记录管理。
  - 支持更多播客平台（如 Spotify, Apple Podcasts）。

### 5.3 V1.2

- **目标**: 提升转写效率和准确性。
- **功能范围**:
  - 增加在线编辑和校对功能。
  - 引入上下文增强功能，允许用户提交自定义词汇表。
  - 优化下载和转写任务的调度算法。

### 5.4 远期规划

- **团队协作**: 支持多人协作编辑转写稿。
- **多语言界面**: 提供多语言版本的网站。
- **增值服务**: 探索面向企业用户的私有化部署或高级功能订阅。
- **AI 摘要增强**: 集成通义听悟更多 AI 能力，如全文摘要、章节速览、关键词提取等。

## 6. 附录

### 6.1 技术调研参考

- **yt-dlp**: [https://github.com/yt-dlp/yt-dlp](https://github.com/yt-dlp/yt-dlp)
- **通义听悟 API 文档**: [https://tingwu.aliyun.com/helpcenter/api](https://tingwu.aliyun.com/helpcenter/api)
- **Qwen-ASR API 参考**: [https://help.aliyun.com/zh/model-studio/qwen-asr-api-reference](https://help.aliyun.com/zh/model-studio/qwen-asr-api-reference)

